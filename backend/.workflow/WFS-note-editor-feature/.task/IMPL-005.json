{
  "id": "IMPL-005",
  "title": "创建 Markdown 源码编辑器组件",
  "status": "pending",
  "meta": {
    "type": "feature",
    "agent": "@code-developer",
    "priority": "medium",
    "estimated_complexity": "low",
    "affected_files": ["lib/presentation/widgets/markdown_source_editor.dart"],
    "dependencies": ["IMPL-001"]
  },
  "context": {
    "requirements": [
      "创建 1 个 Widget: MarkdownSourceEditor 用于 Markdown 源码编辑",
      "基于 TextFormField 实现源码编辑功能",
      "实现 3 个特性: [等宽字体显示, 多行编辑, 实时内容回调]"
    ],
    "focus_paths": ["lib/presentation/widgets/"],
    "acceptance": [
      "组件创建成功: 验证 MarkdownSourceEditor widget 存在",
      "源码编辑正常: 验证可以编辑 Markdown 文本",
      "等宽字体生效: 验证显示使用 Courier 或 monospace 字体",
      "内容回调有效: 验证 onContentChanged 回调正常触发"
    ],
    "description": "创建简洁的 Markdown 源码编辑器组件，使用等宽字体显示和编辑纯文本格式的 Markdown 内容",
    "technical_notes": [
      "使用 TextFormField 作为基础组件",
      "设置 maxLines: null 支持多行编辑",
      "使用 monospace 字体（如 Courier, Consolas）",
      "可选功能：行号显示（使用 Row + Text + TextFormField 组合）",
      "可选功能：语法高亮（使用 flutter_highlight 包，可作为未来增强）"
    ]
  },
  "flow_control": {
    "pre_analysis": [
      {
        "step": "analyze_text_input_patterns",
        "commands": [
          "bash(rg 'TextFormField|TextEditingController' ../frontend/lib/presentation/ --type dart -n --max-count 10)"
        ],
        "output_to": "text_input_patterns",
        "on_error": "skip_optional"
      }
    ],
    "implementation_approach": [
      {
        "step": 1,
        "title": "创建 Widget 基础结构",
        "description": "定义 MarkdownSourceEditor StatefulWidget",
        "modification_points": [
          "创建 1 个文件: lib/presentation/widgets/markdown_source_editor.dart (约 100 行)",
          "定义 MarkdownSourceEditor 类和 State 类",
          "添加构造函数参数: [initialContent, onContentChanged]"
        ],
        "logic_flow": [
          "创建 markdown_source_editor.dart 文件",
          "定义 StatefulWidget 和 State 类",
          "声明 TextEditingController",
          "定义回调函数签名"
        ],
        "depends_on": [],
        "output": "widget_skeleton"
      },
      {
        "step": 2,
        "title": "实现 TextFormField 配置",
        "description": "配置等宽字体、多行编辑和样式",
        "modification_points": [
          "实现 build() 方法（约 60 行）",
          "配置 TextFormField 属性: [maxLines: null, keyboardType: TextInputType.multiline]",
          "设置 TextStyle: [fontFamily: 'Courier', fontSize: 14]",
          "添加 decoration 配置边框和提示"
        ],
        "logic_flow": [
          "在 initState 初始化 TextEditingController",
          "设置 initialContent 到 controller",
          "配置 TextFormField 样式和行为",
          "监听 controller 变化触发 onContentChanged",
          "在 dispose 中释放 controller"
        ],
        "depends_on": [1],
        "output": "text_field_config"
      },
      {
        "step": 3,
        "title": "添加内容提取方法",
        "description": "提供 getContent() 方法供外部调用",
        "modification_points": [
          "添加 1 个方法: getContent() 返回 String",
          "直接返回 TextEditingController.text"
        ],
        "logic_flow": [
          "定义 getContent() 方法",
          "返回 _controller.text",
          "供外部保存时调用"
        ],
        "depends_on": [2],
        "output": "content_extraction"
      }
    ],
    "target_files": [
      "lib/presentation/widgets/markdown_source_editor.dart"
    ],
    "depends_on": ["IMPL-001"],
    "blocks": ["IMPL-006", "IMPL-007"]
  }
}
