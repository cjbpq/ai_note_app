{
  "id": "IMPL-002",
  "title": "创建编辑模式状态管理",
  "status": "pending",
  "meta": {
    "type": "feature",
    "agent": "@code-developer",
    "priority": "high",
    "estimated_complexity": "medium",
    "affected_files": [
      "lib/providers/notes_provider.dart",
      "lib/models/note_edit_mode.dart"
    ],
    "dependencies": ["IMPL-001"]
  },
  "context": {
    "requirements": [
      "创建 1 个枚举: NoteEditMode 包含 3 个值 [preview, wysiwyg, markdown]",
      "修改 1 个 provider: noteDetailProvider 添加编辑模式状态管理",
      "实现 3 个功能: [模式切换逻辑, 编辑状态追踪, 内容同步控制]"
    ],
    "focus_paths": ["lib/providers/notes_provider.dart", "lib/models/"],
    "acceptance": [
      "枚举创建成功: 验证 NoteEditMode 包含 3 个值",
      "状态管理集成: 验证 noteDetailProvider 包含 editMode 和 isEditing 状态",
      "模式切换正常: 验证 switchEditMode() 方法可以切换 3 种模式"
    ],
    "description": "创建笔记编辑模式的状态管理，支持预览、WYSIWYG 编辑、Markdown 源码编辑三种模式的切换和状态追踪",
    "technical_notes": [
      "使用 flutter_riverpod StateNotifier 管理编辑状态",
      "编辑模式切换时需要保存当前内容",
      "模式切换需要处理内容格式转换",
      "需要支持编辑状态的持久化（可选，用于恢复编辑）"
    ]
  },
  "flow_control": {
    "pre_analysis": [
      {
        "step": "analyze_existing_provider",
        "commands": [
          "bash(rg 'noteDetailProvider|StateNotifier' ../frontend/lib/providers/ --type dart -n --max-count 20)"
        ],
        "output_to": "provider_structure",
        "on_error": "skip_optional"
      }
    ],
    "implementation_approach": [
      {
        "step": 1,
        "title": "创建编辑模式枚举",
        "description": "定义 NoteEditMode 枚举表示三种编辑模式",
        "modification_points": [
          "创建 1 个文件: lib/models/note_edit_mode.dart (约 15 行)",
          "定义枚举包含 3 个值: [preview, wysiwyg, markdown]"
        ],
        "logic_flow": [
          "创建 note_edit_mode.dart 文件",
          "定义 NoteEditMode 枚举",
          "添加辅助方法（如 displayName）"
        ],
        "depends_on": [],
        "output": "note_edit_mode_enum"
      },
      {
        "step": 2,
        "title": "扩展 noteDetailProvider 状态",
        "description": "添加编辑模式和编辑状态到现有 provider",
        "modification_points": [
          "修改 1 个文件: lib/providers/notes_provider.dart",
          "添加 2 个状态字段: [NoteEditMode editMode, bool isEditing]",
          "添加 3 个方法: [switchEditMode(), startEditing(), cancelEditing()]"
        ],
        "logic_flow": [
          "在 NoteDetailState 添加 editMode 和 isEditing 字段",
          "实现 switchEditMode() 方法处理模式切换",
          "实现 startEditing() 和 cancelEditing() 管理编辑状态",
          "在模式切换时触发内容同步"
        ],
        "depends_on": [1],
        "output": "extended_provider"
      }
    ],
    "target_files": [
      "lib/models/note_edit_mode.dart",
      "lib/providers/notes_provider.dart"
    ],
    "depends_on": ["IMPL-001"],
    "blocks": ["IMPL-003", "IMPL-004", "IMPL-005", "IMPL-006"]
  }
}
