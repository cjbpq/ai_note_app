# � 项目任务清单 (TODO List)

> 历史已完成任务请查看 [History.md](History.md) | 长期规划请参考 [ROADMAP.md](ROADMAP.md)

## ✅ 已完成（自动记录）

- [x] 文档/规范：增强 Copilot 开发指南（Android 优先、API 错误→Toast、交付审查、错误映射表）✅ 2026-02-09
  - 重大决策：Android 真机优先，iOS 尽量保持一致性；有不兼容需提前报出
  - 架构实现：明确 UI→Hooks→Services 分层下的错误解析与 toast 触发位置，减少 UI try-catch
  - 特殊细节：新增“错误场景→i18n key→toast 类型”小表，避免后续重复造轮子
  - 后续迭代：把 422/常见错误码映射规范逐步落实到各业务模块 Service/Hooks，并在 TODO 中持续跟踪

## 当前紧急/修复 (Phase 1.5 Polish)

**目标：生产环境体验优化与遗留 Bug 修复**

- [ ] **用户体验 (UX)**
  - [ ] **登录反馈优化**: 用户登录失败（如密码错误）时缺乏友好提示及基本流程处理。
  - [ ] **编辑模式重构**: 当前编辑模式体验需优化或重新设计。
  - [ ] **主题一致性**: 登录+注册页面底部的 Tab 栏未同步主题模式切换。
  - [ ] **Toast 队列优化**: 评估高频触发时的消息堆积问题，考虑为 Error 消息增加时长或优先级。
  - [ ] **拍照预览优化**: 拍照结果页需要更优的展示方案（折叠原文/更多结构化信息）。

- [ ] **数据与安全**
  - [ ] **多设备限制**: 开发后期需完成多设备同步登录限制。
  - [ ] **注册校验**: 补充强密码规则与重复密码确认（前端校验）。

## 下一阶段功能 (Next Features)

**目标：完善核心业务闭环**

- [ ] **收藏系统 (Favorites)**
  - [ ] **收藏列表页**: 独立的页面仅展示已收藏笔记。
  - [ ] **离线同步**: SQLite 缓存需同步 is_favorite 字段状态。

- [ ] **用户中心 & 设置 (Settings)**
  - [ ] 搭建用户中心各个基础跳转页面。
  - [ ] 配置 React Native Paper 全局字体 (Fonts) 规范。

- [ ] **搜索功能 (Search)**
  - [ ] 全局搜索入口与实现。

- [ ] **进阶功能**
  - [ ] **导出功能**: 支持导出笔记为 Image/PDF/Text。
  - [ ] **多图上传**: 允许用户拍照或选取多张照片（需后端支持）。

## 技术债与架构优化 (Refactoring & Tech Debt)

### 数学公式引擎 (Math Engine Iteration)

- [ ] **P1 (短期)**: 内容清洗管道 (Hook/Service 层预处理 LaTeX 分隔符)。
- [ ] **P1 (短期)**: 渲染失败兜底 (显示原始文本 + 错误标记上报)。
- [ ] **P2 (中期)**: 评估 MathJax v3 SVG 方案 (更高兼容性)。
- [ ] **P2 (中期)**: 全内容 WebView 渲染模式 (针对重公式长文)。
- [ ] **P3 (长期)**: 服务端预渲染 (SVG/PNG)。

### 离线优先架构 (Offline First)

- [ ] **离线刷新重构**: 本地优先读/写 -> 失败回滚 -> 后台同步队列。
- [ ] **Store 类型完善**: 完善 useScanStore, useUIStore 的 TypeScript 类型定义。
- [ ] **Token 刷新策略**: 添加 Token 主动刷新策略（过期前自动刷新）。
- [ ] **Secure Storage**: 生产环境评估 expo-secure-store 替代 AsyncStorage 存储 Token。

### 后端与接口

- [ ] **错误处理映射**: 映射后端 422 错误码 -> i18n 友好文案。
- [ ] **注册逻辑完善**: 待后端接入真实邮箱限制。

> 提示：本次已先补齐“规范/映射表”；下一步建议把 422 映射落到具体模块（Service/Hooks）里，接入全局 toast。
